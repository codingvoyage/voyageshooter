-- This is the boss of Stage one. I like Touhou's bullet hell and all, but I am
-- also fond of the wanton. recklessness of FPSs. This boss will be reckless.
    -- Sweep in from the side of the screen
    -- First of all, the boss is spawned at (-200, -200)
    -- We want it to move to the center of the screen, close to the top


var state 0

-- Create the auxiliary threads
newthread 39 "weaponthread"
newthread 40 "movementthread"

-- Give the program a moment to register the new threads...
wait 20

-- Pass the auxiliary threads the ID of this thread
getThreadID ourID
callthreadfunction "weaponthread" [giveMainHandle] ourID
callthreadfunction "movementthread" [giveMainHandle] ourID

-- Execute the initial entrance sequence.
var complete false
while complete != true
    wait 50
    callthreadfunction "movementthread" [isInitialEntranceDone] --> complete
wend

print "DONE WITH ENTRANCE SEQUENCE"

-- The battle begins.
-- Switch between normal shooting attacks and the charging attack
-- Once HP drops below a critical point, execute the desperation move.

var desperation false
while desperation != true

    -- CHARGE ATTACK
    setvar state 1
    wait 5000

    -- At this point, we also want to make life more complicated by spawning two
    -- other enemies to harass the player! BULLET SPAM TEAM LET'S GO!
    setvar state 2
    wait 10000

    -- If health is below a certain point, then set desperation to true
    -- (To be written)
wend


-- Desperate last attack

setvar state 3

label [WAITTODIE]
    -- If health is below 0, then perform cleanup


    wait 500

goto [WAITTODIE]


endthread



function [getCurrentState]
return state





label [donothing]

    wait 250

    faceplayer

    for count = 0 and count < 5
        callscriptfunction 25 [shoot]
        wait 50
    next count + 1 --> count

goto [donothing]
