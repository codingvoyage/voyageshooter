var mainhandle
var initialEntranceDone false
var ENTITYID "boss"

-- Needed for loading purposes.
wait 50

-- Give this Thread a reference to the Entity
getThreadID ourID
bindthreadtomarionette ourID ENTITYID


label [LOOP]


    -- Get the current State from the mainhandle, so it's like asking
    -- mission control or the brain for the latest news.
    callthreadfunction mainhandle [getCurrentState] --> currentState


    -- ======================
    -- Initial entry sequence
    -- ======================
    if currentState == 0
            -- Direction and velocity to the center
            rotate 118
            newvelocity 0.5

            move 750

            -- We're done now
            setvar initialEntranceDone true

            wait 1000
    endif

    -- ====================
    -- Body-slam the player!
    -- ====================
    if currentState == 1
            faceplayer

            -- Give the player like a second to get out of the way.
            wait 600

            -- Charge forward!
            newvelocity 0.7
            print "WE CHARGE"
            move 1000

            -- We must get random two coordinates around now
            -- Start by choosing from a range of x
            rand -150 1200 --> xplace

            -- If it's within the limits of the screen's width...
            -- then we will next choose whether to spawn from above
            -- the screen or from below the screen
            if [ xplace < 1000 ] && [ xplace > -100 ]

                rand 0 1 --> topbottom

                if topbottom == 0
                    var yplace -100
                    goto [else...]
                endif
                    var yplace 800
                label [else...]

                goto [elselol]
            endif
                -- Otherwise, then we picked to spawn it from the sides, so now
                -- choose any distance along the y axis to spawn the enemy
                rand -100 800 --> yplace
            branch [elselol]

            -- Plop the entity at the designated spot
            place xplace yplace

            wait 800

    endif

    -- ====================
    -- Hover around the middle
    -- ====================
    if currentState == 2
            print "asdf"
            place 450 200
            faceplayer
            wait 800

    endif

    -- ====================
    -- Move to the center.
    -- ====================
    if currentState == 3
            -- Fly into the center of the screen from a random location
            -- We must get random two coordinates around now
            -- Start by choosing from a range of x
            rand -150 1200 --> xplace

            -- If it's within the limits of the screen's width...
            -- then we will just spawn from above...
            if [ xplace < 1000 ] && [ xplace > -100 ]
                var yplace -100
                goto [skiplol]
            endif
                -- Otherwise, then we picked to spawn it from the sides, so now
                -- choose somewhere between -100 and 400 to spawn.
                rand -100 400 --> yplace
            branch [skiplol]

            -- Plop the entity at the designated spot
            place xplace yplace

            -- Now face the center.
            facepoint 450 150

            -- Find the distance to the center now, and move to it.
            callscriptfunction 1 [getDistanceToPoint] xplace yplace 450 150 --> moveDistance
            move moveDistance

            -- Make sure to shoot straight down.
            setRotation 180

            -- We're done. This is the enemy's last attack, so just wait to die
            setvar loop true
            while loop == true
                wait 5000
            wend
    endif

    wait 100
goto [LOOP]





function [isInitialEntranceDone]

return initialEntranceDone


function [giveMainHandle] thehandle
    setvar mainhandle thehandle
return